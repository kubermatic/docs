+++
title = "KKP KubeOne Integration"
date = 2023-02-21T14:07:15+02:00
weight = 7

+++

This section describes how to import and manage KubeOne clusters in KKP.
We can import/connect an existing KubeOne cluster. Imported Cluster can be viewed and edited.

  Currently Supported Providers:
   - [AWS]({{< ref "./aws" >}})
   - [Google Cloud Provider]({{< ref "./gcp" >}})
   - [Azure]({{< ref "./azure" >}})
   - [DigitalOcean]({{< ref "./digitalocean" >}})
   - [Hetzner]({{< ref "./hetzner" >}})
   - [OpenStack]({{< ref "./openstack" >}})
   - [vSphere]({{< ref "./vsphere" >}})


## Prerequisites

The following requirements must be met to import a KubeOne cluster:
 - The KubeOne cluster must already exist before we begin the import/connect process.
 - KubeOne configuration manifest: YAML manifest file that describes the KubeOne cluster configuration.
   If you  don't have the manifest of your cluster, it can be generated by running `kubeone config dump -m kubeone.yaml -t tf.json` from your KubeOne terraform directory.
 - Private SSH Key used to create the KubeOne cluster:  KubeOne connects to instances over SSH to perform any management   operation.
 - Provider Specific Credentials used to create the cluster.

 > For more information on the KubeOne configuration for different environments, checkout the [Creating the Kubernetes Cluster using KubeOne]({{< relref "../../../../kubeone/main/tutorials/creating-clusters/" >}}) documentation.

## Import KubeOne Cluster

KKP allows connecting any existing KubeOne cluster of supported provider to view and edit the cluster's current state.

- To import a KubeOne cluster go to `KubeOne Clusters` page and Click the `Import KubeOne Cluster` button.

![Import KubeOne Cluster](/img/kubermatic/v2.25/tutorials/kubeone-clusters/cluster-list-empty.png "Import KubeOne Cluster")

- Select the KubeOne cloud provider.

![Select Provider](/img/kubermatic/v2.25/tutorials/kubeone-clusters/import-kubeone-cluster.png "Select Provider")

- See [AWS]({{< ref "./aws" >}}) / [Google Cloud Provider]({{< ref "./gcp" >}})/[Azure]({{< ref "./azure" >}})/[DigitalOcean]({{< ref "./digitalocean" >}})/[Hetzner]({{< ref "./hetzner" >}})/[OpenStack]({{< ref "./openstack" >}})/[vSphere]({{< ref "./vsphere" >}})
 specific documentation for detailed cluster import steps.

After the cluster has been imported, we can see the details of the cluster in the dashboard.

![Cluster Details](/img/kubermatic/v2.25/tutorials/kubeone-clusters/cluster-details.png "Imported AWS Cluster")

![KubeOne Cluster List](/img/kubermatic/v2.25/tutorials/kubeone-clusters/cluster-list.png "KubeOne Cluster List")

## Cluster Details Page

After the cluster is imported, the KKP controller retrieves the cluster kubeconfig to display all necessary information.
A healthy cluster has `Running` state. Move the mouse cursor over the state indicator to get more details.

## Update Cluster

{{% notice info %}}
KKP supports latest KubeOne code hence supported Kubernetes version has to be '>= 1.24'.
If your cluster is running an older Kubernetes version, an older KubeOne version has to be used to upgrade your cluster to a supported version first.
Please refer to the [KubeOne Compatibility section]({{< relref "../../../../kubeone/main/architecture/compatibility/supported-versions/" >}}) docs for more details.
{{% /notice %}}

### Upgrade Cluster Version

When an upgrade for the cluster is available, a little dropdown arrow will be shown beside the `Control Plane Version` on the clusterâ€™s page.
To start the upgrade, choose the desired version from the list of available upgrade versions and click on `Change Version`.

![Upgrade Cluster](/img/kubermatic/v2.25/tutorials/kubeone-clusters/upgrade-cluster.png "Upgrade Cluster")

If the version upgrade is valid, the cluster state will change to `Reconciling`.

## Update the Machine Deployment Version

Kubelet version on the worker nodes managed by Machine Deployments can be updated as follows:

- Navigate to the cluster overview, scroll down to machine deployments.

- Click on the edit icon next to the machine deployment we want to edit.

![Update Machine Deployment Version](/img/kubermatic/v2.25/tutorials/kubeone-clusters/update-md-list.png "Update Machine Deployment Version")

- Upgrade Kubelet Version. Select the Kubelet Version from the dropdown to upgrade the machine deployment.

![Select Version](/img/kubermatic/v2.25/tutorials/kubeone-clusters/update-md-dialog.png "Select Version")

## Disconnect Cluster

{{% notice info %}}
Disconnect operation does not delete the cluster from the cloud provider.
{{% /notice %}}

We can `Disconnect` a KubeOne cluster by clicking on the disconnect icon next to the cluster we want to disconnect or from the cluster details page.

![Disconnect KubeOne Cluster](/img/kubermatic/v2.25/tutorials/kubeone-clusters/disconnect-cluster-list.png "Disconnect KubeOne Cluster")

![Disconnect KubeOne Cluster on Details Page](/img/kubermatic/v2.25/tutorials/kubeone-clusters/disconnect-cluster-details.png "Disconnect KubeOne Cluster on Details Page")

![Disconnect Dialog](/img/kubermatic/v2.25/tutorials/kubeone-clusters/disconnect-cluster-dialog.png "Disconnect Dialog")

## Troubleshoot
To Troubleshoot a failing imported cluster we can `Pause` cluster by editing the external cluster CR.

```bash
# set externalcluster.spec.pause=true
kubectl edit externalcluster xxxxxxxxxx
```

Once we are done, we can reset the `pause` flag on the externalcluster:

```bash
# set externalcluster.spec.pause=false
kubectl edit externalcluster xxxxxxxxxx
```
